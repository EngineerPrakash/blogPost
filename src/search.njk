---
layout: layouts/page.njk
title: Search
permalink: /search/
---

<p>Type to search titles, descriptions, and content.</p>

<input id="search-input" type="search" placeholder="Search posts..." style="width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);background:var(--panel);color:var(--text)"/>
<div id="results" style="margin-top:16px"></div>

<script>
  (function(){
    const input = document.getElementById('search-input');
    const results = document.getElementById('results');
    const base = '{{ env.base or "" }}';
    let index = [];
    let ready = false;
    function render(items){
      if(!items.length){ results.innerHTML = '<p class="muted">No results.</p>'; return; }
      results.innerHTML = items.map(p => `
        <article class="post-card">
          <h2><a href="${base}${p.url}">${p.title}</a></h2>
          <p class="meta">${new Date(p.date).toLocaleDateString()}${p.tags && p.tags.length? ' Â· ' + p.tags.join(', ') : ''}</p>
          ${p.description ? `<p>${p.description}</p>` : ''}
        </article>
      `).join('');
    }
    function scorePost(p, q){
      const hay = (p.title + ' ' + (p.description||'') + ' ' + (p.content||'')).toLowerCase();
      const tokens = q.toLowerCase().split(/\s+/).filter(Boolean);
      if(!tokens.length) return 0;
      let s = 0;
      for(const t of tokens){
        if(hay.includes(t)) s += t.length; // simple token presence scoring
      }
      // bonus for title matches
      for(const t of tokens){ if((p.title||'').toLowerCase().includes(t)) s += t.length; }
      return s;
    }
    function onInput(){
      const q = input.value.trim();
      if(!q){ results.innerHTML = ''; return; }
      const ranked = index
        .map(p => ({ p, s: scorePost(p, q) }))
        .filter(x => x.s > 0)
        .sort((a,b) => b.s - a.s)
        .slice(0, 30)
        .map(x => x.p);
      render(ranked);
    }
    fetch(base + '/search.json').then(r => r.json()).then(data => { index = data; ready = true; });
    input.addEventListener('input', onInput);
  })();
  </script>
